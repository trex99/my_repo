# 2‑Wasserstein 거리 추정을 위한 Back‑and‑Forth 알고리즘과 ICNN 메모리 뱅크 확장

## 1. 서론

### 1.1 배경과 문제의식
최적수송은 확률분포 사이의 차이를 기하적으로 포착하는 원리이며, 그중에서도 비용을 제곱 거리로 두는 2‑Wasserstein 제곱거리는 이론적 해석 가능성과 응용 범용성을 동시에 갖춘 척도다. 그러나 신경망을 이용해 이 거리를 직접 근사하려 할 때는, 세미듀얼 구조에 내재한 c‑볼록성 제약과 c/cc‑transform 계산이 병목으로 작용한다.

특히 미니배치 환경에서는 변환의 비매끄러움과 배치 지지의 한계 때문에 목적함수의 일관성이 쉽게 깨져 안정적 학습이 어렵다. 기존 접근은 Brenier 포텐셜/수송맵의 직접 근사나 정칙화·투영 기반 완화에 집중했지만, c‑볼록 일관성을 정량적으로 감시하고 그 위반을 체계적으로 교정하는 메커니즘은 상대적으로 부족했다.

### 1.2 연구 목표
본 연구는 2‑Wasserstein 거리 추정을 위한 새로운 신경망 학습 프레임워크를 제안한다. 핵심 아이디어는 c‑볼록성 일관성 갭을 정량화하고, 이를 기반으로 최적화 목표를 동적으로 전환하는 것이다.

구체적으로, 일관성 갭(델타 뮤, 델타 뉴)이 클 때는 갭 감소에 집중하고, 갭이 작아지면 인증된 하한을 끌어올리는 방향으로 목적을 바꾸는 Back‑and‑Forth 알고리즘을 설계한다. 이 적응적 전환은 미니배치 환경에서 볼록성 제약 보존과 거리 추정 정확도 사이의 트레이드오프를 효과적으로 관리한다.

> **스코프 한정.** 본 논문은 *거리 추정 문제*에 한정하며, 생성기 학습이나 생성 품질 평가는 다루지 않는다.
### 1.3 공헌 요약
첫째, 세 가지 목적함수(J1, J2, J3)와 일관성 지표(델타 뮤, 델타 뉴)를 엄밀히 정식화하고 이들 사이의 부등식·동치 관계를 증명한다. 특히 J3를 J1에 마이너스 파이를 대입한 형태로 정의함으로써 부호‑대칭 모호성을 제거하고, 보수적 하한 B(varphi)=min{J1(varphi), J3(varphi)}를 직접 최대화할 수 있도록 하였다.

둘째, 위의 정식화를 활용하여 Back‑and‑Forth 알고리즘을 제안한다. 이는 일관성 갭이 클 때 갭 감소에, 작을 때 하한 상승에 집중하는 적응적 학습 전략으로, 두 방향의 상보적 편향 가운데 더 불리한 하한을 끌어올리는 최악‑경우 보장을 제공한다. 셋째, 입력‑볼록 신경망(ICNN)에 메모리‑뱅크 레이어를 도입해 지역 이차/선형 패치를 제공함으로써 c‑transform 근사 오차와 서브그라디언트 변동성을 줄이고, 입력 볼록성을 보존한 채 표현력을 확장한다. 마지막으로 본 연구는 거리 추정 문제 자체에 초점을 맞추며, 생성 모델 학습이나 샘플 품질 비교는 범위 밖으로 둔다.

---

## 2. 관련 연구
본 연구는 세 축을 배경으로 한다. (i) \(W_2\)에 대한 Kantorovich 이중성과 세미듀얼 정식화, (ii) Brenier 포텐셜 및 ICNN 기반 최적수송의 신경망 접근, (iii) 본문 목적함수의 올바른 비교와 수렴 보장을 뒷받침하는 Fenchel–Young 부등식과 공액함수 이론. 이 틀 위에서 §3–§5의 기호·정리들을 도입하고, §6의 알고리즘과 §7의 구조 설계를 정당화한다.
## 3. 표기와 기본 가정
- 배경공간은 \(\mathbb{R}^d\)이고 노름은 유클리드 노름 \(\|\cdot\|\)이다. 비용은 \(c(x,y)=\|x-y\|^2\)로 둔다.
- \(\mathbb{R}^d\) 위의 확률측도 \(\mu,\nu\)는 2차 모멘트가 유한하다. 기댓값은 \(\mathbb{E}_\mu[f]=\int f\,d\mu\)로 표기한다.
- 함수 \(f\)의 \(c\)-transform과 \(cc\)-transform은 다음과 같다.
  
  \[
  f^{\,c}(y)=\inf_{x\in\mathbb{R}^d}\{\|x-y\|^2-f(x)\},\qquad f^{cc}(x)=\inf_{y\in\mathbb{R}^d}\{\|x-y\|^2-f^{\,c}(y)\}.
  \]
- 함수 \(\varphi\)가 어떤 \(\psi\)에 대해 \(\varphi=\psi^{\,c}\)이면 \(c\)-볼록이라고 한다.
- Brenier 파라미터화는 볼록 함수 \(u\)에 대해 \(\varphi(x)=\|x\|^2-u(x)\)로 둔다.

**가정 A. 모멘트와 지지.** \(\mu,\nu\)는 유한한 2차 모멘트를 갖고, 미니배치의 지지는 컴팩트 집합 \(K_\mu, K_\nu\subset\mathbb{R}^d\)에 포함된다.

---

## 4. 수학적 예비 지식

### 4.0 Brenier 정리와 파라미터화의 연결(정확화)
**정리 4.0 (Brenier).** 비용이 제곱거리이고 \(\mu\)가 르벡 측도에 절대연속이며 두 분포가 유한한 2차 모멘트를 갖는다면, \(\mu\)에서 \(\nu\)로 가는 최적 수송맵 \(T\)가 존재하고 \(T=\nabla u\)인 볼록 함수 \(u:\mathbb{R}^d\to\mathbb{R}\)가 있다(\(\mu\)-거의 모든 점에서 유일). 또한 최적 결합은 그래프 \({(x,\nabla u(x))}\) 위에 지지된다.

**연결 고리.** 이 결과로부터 **Kantorovich 잠재** \((\varphi,\psi)\)와 **볼록 잠재** \(u\) 사이의 표준 대응이 유도된다. 구체적으로, \((\varphi,\psi)\)가 최적 이중 쌍이고 \(u\)가 Brenier 잠재라면
\[\varphi(x)=\|x\|^2-u(x)+C,\qquad \psi(y)=\|y\|^2-u^*(2y)-C\]
를 만족하는 상수 \(C\)가 존재한다. 역으로 임의의 볼록 \(u\)에 대해 \( \varphi(x)=\|x\|^2-u(x) \), \( \psi=\varphi^{\,c} \)로 두면 \((\varphi,\psi)\)는 \(c\)-볼록 제약을 만족한다. 최적성 조건(접촉집합 등호) 아래에서 \( y\in\partial u(x) \)가 성립하며, \(u\)의 아측미분이 최적 결합의 지지 집합을 제공한다. (참고: \(\varphi\)와 \(\psi\)는 상수항까지만 정해지며, \(J_1(\varphi)=\mathbb{E}_\mu[\varphi]+\mathbb{E}_\nu[\varphi^{\,c}]\)에서는 상수항이 상쇄되어 값에 영향을 주지 않는다.)

**증명 스케치.** 최적성 조건 \( \varphi(x)+\psi(y)=\|x-y\|^2 \)이 성립하는 점쌍에서 \( y\in\partial u(x) \)와 동치임을 이용한다. 제곱비용 전개 \( \|x-y\|^2=\|x\|^2+\|y\|^2-2\langle x,y\rangle \)와 공액 정의를 결합하면 위의 대응식(상수 \(C\) 포함)을 얻는다. 이는 §4.2의 전개 \( \varphi^{\,c}(y)=\|y\|^2-u^*(2y) \)와 일치한다.


### 4.1 프리멀, 듀얼, 세미듀얼의 도출
**요약 정식화.** 프리멀은 결합분포 \(\pi\) 위 평균 제곱비용의 최소화이고, 이중은 \((\varphi,\psi)\)가 \(\varphi(x)+\psi(y)\le \|x-y\|^2\)을 만족하는 범위에서 \(\mathbb{E}_\mu[\varphi]+\mathbb{E}_\nu[\psi]\)의 최대화이다. 세미듀얼은 \(\psi=\varphi^{\,c}\)로 축약되어
\[
W_2^2(\mu,\nu)=\sup_{\varphi}\{\mathbb{E}_\mu[\varphi]+\mathbb{E}_\nu[\varphi^{\,c}]\}
\]
로 쓴다. 이후 표기는 \(\psi=\varphi^{\,c}\)를 **기본 규약**으로 고정한다.
**정의 4.1. 프리멀 문제.**
\[
W_2^2(\mu,\nu)=\inf_{\pi\in\Pi(\mu,\nu)} \int\!\|x-y\|^2\,d\pi(x,y).
\]

**정리 4.2. 듀얼 문제.**
\[
W_2^2(\mu,\nu)=\sup_{\varphi,\psi}\Big\{\mathbb{E}_\mu[\varphi]+\mathbb{E}_\nu[\psi]:\ \varphi(x)+\psi(y)\le \|x-y\|^2\ \forall x,y\Big\}.
\]

**증명 개요.** 결합 제약에 라그랑지안을 도입한 뒤 \(\mathcal{P}(\mathbb{R}^d\times\mathbb{R}^d)\)에서 Fenchel–Rockafellar 이중성을 적용한다. 부등식 제약은 비용의 에피그래프 지시함수를 유도하며, 그 지지함수는 점별 제약과 일치한다. 비용의 하반연속성과 2차 모멘트 조건 아래에서 강결합이 성립한다.

**명제 4.3. 세미듀얼.** 최적해에서 \(\psi=\varphi^{\,c}\)가 존재하므로 다음이 성립한다.
\[
W_2^2(\mu,\nu)=\sup_{\varphi}\big\{\mathbb{E}_\mu[\varphi]+\mathbb{E}_\nu[\varphi^{\,c}]\big\}.
\]

**증명.** 제약식으로부터 모든 \(y\)에 대해 \(\psi(y)\le \inf_x\{c(x,y)-\varphi(x)\}=\varphi^{\,c}(y)\)가 된다. \(\psi\)를 \(\varphi^{\,c}\)로 치환하면 목적함수가 증가하므로 최적 \(\psi\)는 \(\varphi^{\,c}\)와 일치한다. 임의의 \((\varphi,\varphi^{\,c})\) 쌍은 항상 가용하다.

### 4.2 제곱 비용과 볼록 공액의 연결
볼록 \(u\)에 대해 \(\varphi=\|\cdot\|^2-u\)로 두면 표준 전개로부터 \(\varphi^{\,c}(y)=\|y\|^2-u^*(2y)\)를 얻는다. 이는 §4.1의 세미듀얼 목적식을 **하나의 볼록 잠재 \(u\)**로 매개하는 도구이며, Fenchel–Young 부등식은 \(\varphi^{\,c}\le -\varphi\)의 유용한 상계를 준다. 이후의 부등식 비교는 이 전개를 기본 레퍼런스로 삼는다.
볼록 \(u\)에 대해 \(\varphi(x)=\|x\|^2-u(x)\)로 두면 다음을 얻는다.
\[
\varphi^{\,c}(y)=\inf_x\{\|x-y\|^2-\|x\|^2+u(x)\}=\|y\|^2-\sup_x\{2\langle x,y\rangle-u(x)\}=\|y\|^2-u^*(2y).
\]

**완전 전개.** \(\|x-y\|^2=\|x\|^2+\|y\|^2-2\langle x,y\rangle\)을 전개해 \(\|x\|^2\)를 상쇄하고, 공액함수 \(u^*(z)=\sup_x\{\langle z,x\rangle-u(x)\}\)의 정의를 \(z=2y\)에 대입한다.

**보조정리 4.4. Fenchel–Young 부등식.** 모든 \(y\)에 대해 \(u(y)+u^*(2y)\ge 2\|y\|^2\). 따라서 \(\varphi^{\,c}(y)=\|y\|^2-u^*(2y)\le -\|y\|^2+u(y)=-\varphi(y)\)가 된다.

### 4.3 \(c\)-볼록 부등식과 일관성 갭
정의에 의해 임의의 \(x,y\)에 대해 \(\varphi^{\,c}(y)\le c(x,y)-\varphi(x)\)가 성립한다. 양변에 대해 각각 \(\inf_y\) 또는 \(\inf_x\)를 취하면 \(\varphi\le\varphi^{cc}\)와 \(\varphi^{\,c}\le (\varphi^{\,c})^{\!c}\)를 얻는다. 이를 바탕으로 다음과 같이 일관성 갭을 정의한다.
\[
\Delta_\mu=\mathbb{E}_\mu[\varphi^{cc}-\varphi]\ge0,\qquad \Delta_\nu=\mathbb{E}_\nu[(\varphi^{\,c})^{\!c}-\varphi^{\,c}]\ge0.
\]

---

## 5. 제안하는 목적함수들
\(J_1(\varphi)\)와 \(J_3(\varphi)=J_1(-\varphi)\)는 모두 \(W_2^2\)의 하한이므로
\[
B(\varphi)=\min\{J_1(\varphi),J_3(\varphi)\}
\]
역시 하한이며, \(B(\varphi)=B(-\varphi)\)의 **부호-대칭성**을 갖는다. 이는 미니배치 비대칭을 평균내지 않고 **더 불리한 쪽의 하한을 끌어올리는** 안전한 목표를 제공한다.
세미듀얼 최적화를 사용하되 \(c\)-볼록 일관성을 다음 함수들로 감시한다.
\[
\begin{aligned}
J_1(\varphi)&=\mathbb{E}_\mu[\varphi]+\mathbb{E}_\nu[\varphi^{\,c}],\\
J_2^{(\mu)}(\varphi)&=\mathbb{E}_\mu[\varphi^{cc}]+\mathbb{E}_\nu[\varphi^{\,c}],\qquad
J_2^{(\nu)}(\varphi)=\mathbb{E}_\mu[\varphi]+\mathbb{E}_\nu[(\varphi^{\,c})^{\!c}],\\
J_3(\varphi)&=\mathbb{E}_\mu[-\varphi]+\mathbb{E}_\nu[(-\varphi)^{\,c}].
\end{aligned}
\]

**보조정리 5.0. 대칭 테스트 함수(\(-\varphi\))의 정당성.** (i) 세미듀얼 함수 \(J_1(f)=\mathbb{E}_\mu[f]+\mathbb{E}_\nu[f^{\,c}]\)는 적절한 적분가능성을 만족하는 임의의 함수 \(f\)에 대해 정의되므로, \(f=-\varphi\)를 대입하여 \(J_1(-\varphi)\)를 계산하는 것은 정당하다. (ii) 이중 제약 \(\phi(x)+\psi(y)\le c(x,y)\)에 대해, 임의의 \(f\)에 대해 쌍 \((f, f^{\,c})\)는 항상 가용(feasible)하다. 실제로 \(f^{\,c}(y)\le c(x,y)-f(x)\)이므로 \(f(x)+f^{\,c}(y)\le c(x,y)\). 따라서 \((-\varphi,(-\varphi)^{\,c})\)도 가용 쌍이며, \(J_1(-\varphi)\)는 합법적인 세미듀얼 하한이다. (iii) 이 구성은 최적해에서 \(\psi=-\varphi\)가 성립한다는 주장을 뜻하지 않는다. 최적에서는 일반적으로 \(\psi=\varphi^{\,c}\)가 성립하며, \(-\varphi\)는 대칭 하한을 구성하기 위한 **테스트 함수 선택**일 뿐이다.

**명제 5.1. 하한.** 모든 \(\varphi\)에 대해 \(J_1(\varphi)\le W_2^2(\mu,\nu)\)와 \(J_3(\varphi)\le W_2^2(\mu,\nu)\)가 성립한다.

**증명.** 세미듀얼 정의에 의해 \(\sup_\varphi J_1=W_2^2\)이므로 \(J_1\le W_2^2\)이다. 또한 본 논문의 정의에 따라 \(J_3(\varphi)=J_1(-\varphi)\)이므로 동일한 하한성이 그대로 적용되어 \(J_3\le W_2^2\)가 성립한다.

**명제 5.2. 상계 완화.** \(J_1\le J_2^{(\mu)}\)이며 \(J_1\le J_2^{(\nu)}\)이다.

**증명.** \(\varphi\le\varphi^{cc}\)이므로 \(\mathbb{E}_\mu[\varphi]\le\mathbb{E}_\mu[\varphi^{cc}]\)이고, 마찬가지로 \(\mathbb{E}_\nu[\varphi^{\,c}]\le\mathbb{E}_\nu[(\varphi^{\,c})^{\!c}]\)가 성립한다.

**정리 5.2a. 대칭-보수 하한의 정당화.** 모든 \(\varphi\)에 대해
\[ B(\varphi):=\min\{J_1(\varphi),\,J_3(\varphi)\}\ \le\ W_2^2(\mu,\nu). \]
또한 \( \sup_\varphi B(\varphi)\le W_2^2(\mu,\nu) \)이며, \( \sup_\varphi J_1(\varphi)=\sup_\varphi J_3(\varphi)=W_2^2(\mu,\nu) \)가 성립한다.

**증명.** 명제 5.1에서 \( J_1(\varphi)\le W_2^2 \) 및 \( J_3(\varphi)\le W_2^2 \). 두 하한의 최소값을 취해도 하한 성질은 유지되므로 \( B(\varphi)\le W_2^2 \). 마지막 진술은 세미듀얼의 타이트니스에서 따른다.

**명제 5.2b. 부호-대칭성.** \( B(\varphi)=B(-\varphi) \).

**증명.** \( J_3(\varphi)=J_1(-\varphi) \)와 \( J_3(-\varphi)=J_1(\varphi) \)에서 바로 따른다.

**주석 5.2c (배치 편향에 대한 강건성).** 미니배치에서 \( c \)-/\( cc \)-transform의 경험적 근사는 분포 \( \mu \)와 \( \nu \)에 대해 상보적인 편향을 가질 수 있다. \( J_1 \)은 \( \mu \)에서 \( \varphi \), \( \nu \)에서 \( \varphi^{\,c} \)를 평가하며, \( J_3=J_1(-\varphi) \)는 그 구조가 반전되어 상보적 편향을 갖는다. 따라서 \( B(\varphi)=\min\{J_1,J_3\} \)를 최대화하면 두 방향 가운데 더 불리한 하한을 끌어올려, 표본 구성의 비대칭성으로 인한 과대·과소평가를 동시에 제어할 수 있다.

**정리 5.3. 일관성에서의 동치.** 다음 세 조건은 서로 동치이다. 첫째, \(\Delta_\mu=\Delta_\nu=0\). 둘째, \(J_1=J_2^{(\mu)}=J_2^{(\nu)}\). 셋째, \(\varphi=\varphi^{cc}\)이고 \(\varphi^{\,c}=(\varphi^{\,c})^{\!c}\)가 거의 모든 점에서 성립한다.

**증명.** 첫째에서 둘째는 명제 5.2로부터 즉시 따른다. 둘째에서 셋째는 기대값 부등식에서 등호가 성립하므로 거의 모든 점에서 함수가 일치함을 강제한다. 셋째에서 첫째는 정의로부터 자명하다.

**따름정리 5.4. 타이트니스.** \(\sup_\varphi J_1=\sup_\varphi J_3=W_2^2\). 최적화자 \(\varphi_*\)는 \(c\)-볼록이며 대응 포텐셜은 \(\psi_* = \varphi_*^{\,c}\)이다.

**안정성 주석.** 미니배치에서는 제한된 변환 \(f^{\,c}(\cdot;\eta)=\inf_{x\in\operatorname{supp}(\eta)}\{\|x-\cdot\|^2-f(x)\}\)을 사용한다. 이때도 명제 5.2는 경험적 부등식을 제공하며, 위반은 표본화로 인한 일관성 결함을 의미한다. 이 사실이 스위칭 규칙의 동기를 제공한다.

---

> **로드맵.** 위 결과들은 §6의 분기 기준과 손실 설계(갭 감소·하한 상승)의 근거로 바로 사용된다.
## 6. Back‑and‑Forth 알고리즘
> **요약 표 — 분기·손실·보장**
>
> | 항목 | 정의 | 직관 | 보장 |
> |---|---|---|---|
> | **분기 기준** | \(\max\{\Delta_\mu,\Delta_\nu\}\) | 가장 큰 일관성 위반을 우선 제어 | §5의 일관성 동치로 정당화 |
> | **갭 감소 손실** | \(\Delta_\mu+\Delta_\nu\) | 두 방향의 갭을 동시에 축소 | 미니배치 편향의 대칭 제어 |
> | **하한 손실** | \(\min\{\widehat J_1,\widehat J_3\}\) | 불리한 쪽 하한을 끌어올림 | \(W_2^2\)에 대한 하한 유지 |
>
**스위칭 규칙의 동기.** \(\Delta_\mu=\Delta_\nu=0\)일 때 \(J_1=J_2^{(\mu)}=J_2^{(\nu)}\)가 되어 \(c\)-볼록 일관성이 회복된다(§5). 이에 따라 분기 기준을 \(\max\{\Delta_\mu,\Delta_\nu\}\), 갭 감소 손실을 \(\Delta_\mu+\Delta_\nu\)\, 하한 손실을 \(\min\{\widehat J_1,\widehat J_3\}\)로 택한다.

### 6.1 미니배치 \(c\)-변환의 한계와 일관성 갭 설계(정확화)

**정의(경험적 \(c\)-변환).** 배치 \(X=\{x_i\}_{i=1}^n,\; Y=\{y_j\}_{j=1}^m\)에 대해
\[
\varphi^{\,c}(y;X)=\min_{x\in X}\{\lVert x-y\rVert^2-\varphi(x)\},\qquad
\varphi^{\,cc}(x;Y)=\min_{y\in Y}\{\lVert x-y\rVert^2-\varphi^{\,c}(y;X)\}.
\]

**사실 6.0(상계 편향).** \(X\subseteq \mathrm{supp}(\mu)\)이면 \(\varphi^{\,c}(y;X)\ge \varphi^{\,c}(y)\)이다(부분집합 위 inf는 값이 커진다). 이 항이 다시 \(\varphi^{\,cc}(\cdot;Y)\)에 들어가므로, 일반적으로 \(\varphi^{\,cc}(x;Y)\)도 \(\varphi^{\,cc}(x)\)보다 커지는 경향이 있다. 따라서 **참 \(c\)-볼록** \(\varphi\)라도 유한 배치에서는
\[
\Delta_{\mu}=\mathbb{E}_{\mu}[\varphi^{\,cc}-\varphi],\qquad
\Delta_{\nu}=\mathbb{E}_{\nu}[(\varphi^{\,c})^{\,c}-\varphi^{\,c}]
\]
가 0이 아닐 수 있다. 즉, **미니배치 근사만으로는 이론적 \(c\)-볼록성이 완벽히 보장되지 않는다.**

**의미.** 위 편향은 배치 지지와 위치에 의존하며, 두 분포에 대해 **비대칭적**일 수 있다. 따라서 한쪽 방향의 갭만 줄이면 다른 쪽이 악화될 위험이 있다. 이 이유로 본 논문은 **두 갭을 동시에 감시·제어**하도록 설계했다.

**설계 원칙(요약).** (i) 분기 기준은 \(\max\{\Delta_{\mu},\Delta_{\nu}\}\)로 잡아 가장 위반이 큰 쪽을 경계로 삼고, (ii) 갭 감소 손실은 \(\Delta_{\mu}+\Delta_{\nu}\)로 하여 두 방향을 동시에 줄인다. 이는 한쪽만 줄이는 동안 다른 한쪽이 커지는 현상을 방지한다.

### 6.2 알고리즘

볼록 함수 \(u_\theta\)를 갖는 포텐셜 \(\varphi_\theta=\|\cdot\|^2-u_\theta\)를 ICNN 구조로 근사하고 이를 최적화한다. 반복 \(t\)에서 미니배치 \(X=\{x_i\}_{i=1}^n\sim\mu\)와 \(Y=\{y_j\}_{j=1}^n\sim\nu\)를 추출한 뒤 다음을 계산한다.
\[
\varphi^{\,c}(y_j;X)=\min_i\{\|x_i-y_j\|^2-\varphi(x_i)\},\qquad
\varphi^{cc}(x_i;Y)=\min_j\{\|x_i-y_j\|^2-\varphi^{\,c}(y_j;X)\}.
\]
이 값들로부터 경험적 목적함수 \(\widehat J_1,\widehat J_2^{(\mu)},\widehat J_3\)과 갭 \(\widehat\Delta_\mu,\widehat\Delta_\nu\)를 정의한다.

**알고리즘 1. Back‑and‑Forth 스위칭**
1. \(\max\{\widehat\Delta_\mu,\widehat\Delta_\nu\}>\tau\)이면 갭 감소 단계를 수행한다. 손실 \(\mathcal{L}_{\text{gap}}=\widehat\Delta_\mu+\widehat\Delta_\nu\)을 \(\theta\)에 대해 최소화한다.
2. 그렇지 않으면 하한 상승 단계를 수행한다. 손실 \(\mathcal{L}_{\text{lb}}=\min\{\widehat J_1,\widehat J_3\}\)을 \(\theta\)에 대해 최대화한다.
3. Armijo 백트래킹이나 코사인 스케줄을 사용하고, 필요하면 log‑sum‑exp 기반의 softmin으로 \(\min\) 연산을 매끄럽게 근사한다.

**정당화(하한 상승 손실).** §5의 정리 5.2a에 의해 \( \widehat B:=\min\{\widehat J_1,\widehat J_3\} \)는 항상 \( W_2^2 \)의 경험적 하한이다. 따라서 \( \widehat B \)를 증가시키는 것은 증명 가능한 의미의 개선이며, 명제 5.2b에 의해 \( \widehat B(\varphi)=\widehat B(-\varphi) \)이므로 부호-대칭 모호성을 제거한다. 또한 주석 5.2c의 논의에 따라, 두 방향의 상보적 편향 가운데 더 약한 하한을 끌어올리는 최악-경우 보장을 제공한다.

### 6.3 하한 손실의 정당화

§5의 정리 5.2a에 의해 (\widehat B:=\min{\widehat J_1,\widehat J_3})는 항상 (W_2^2)의 **경험적 하한**이다. 따라서 (\widehat B)를 증가시키는 것은 **증명 가능한 의미의 개선**이며, 명제 5.2b에 의해 (\widehat B(\varphi)=\widehat B(-\varphi))이므로 부호-대칭 모호성을 제거한다. 또한 주석 5.2c에 따라, 두 방향의 상보적 편향 가운데 더 약한 하한을 끌어올리는 **최악-경우 보장**을 제공한다.

**명제 6.1(하강과 상승의 방향).** 위 절차는 Danskin 정리에 의해 타당한 서브그라디언트 갱신을 이룬다. softmin을 사용하면 표준 그래디언트를 사용할 수 있다.

**정리 6.2(보호된 진행).** 스텝 크기가 감소하지만 비가산 조건을 만족하면: (i) 갭 수열의 하한극한은 0, (ii) 임의의 극한점 (\theta_*)는 배치 지지에서 (c)-볼록 일관성을 만족, (iii) 갭이 작은 구간에서는 (\widehat J_1)이 비감소.

**증명 개요.** 갭 감소 단계는 구성상 (\widehat\Delta)를 줄이고, 하한 상승 단계는 (\min{\widehat J_1,\widehat J_3}\le W_2^2)를 증가시킨다. 확률근사 이론으로 결론이 따른다.

### 6.4 갭 선택과 목적 설정의 정당화

**명제 6.4.1(분기에서의 (\max)).** (\max{\Delta_\mu,\Delta_\nu}>\tau)이면 적어도 한 방향의 (c)-볼록 위반이 임계치를 초과하므로 갭 감소 단계로의 분기가 타당하다. 반대로 (\max{\Delta_\mu,\Delta_\nu}\le \tau)이면 두 방향 모두 허용 오차 내이므로 하한 상승 단계로 전환해도 일관성 면에서 안전하다.

**명제 6.4.2(손실에서의 합).** 갭 손실을 (\mathcal{L}*{\text{gap}}=\Delta*\mu+\Delta_\nu)로 두면, (i) 둘 중 큰 항이 자동으로 지배해 (\max)-기반 분기와 정합성을 유지하고, (ii) 두 항이 모두 양수일 때 **동시에 감소**하도록 유도하며, (iii) 한 항이 이미 0이면 기울기는 자연스럽게 다른 항으로 집중된다.

### 6.5 하이퍼파라미터 정책(“튜닝 없음”과의 합치)

본 논문은 “하이퍼파라미터 튜닝 없이도”라는 목표와 합치하도록, **기본 알고리즘에서 추가 하이퍼파라미터 (w,k,\delta)를 사용하지 않는다**. 즉,

* 분기 기준은 단일 임계값 (\tau)만 사용,
* 갭 손실은 (\mathcal{L}*{\text{gap}}=\Delta*\mu+\Delta_\nu), 하한 손실은 (\mathcal{L}_{\text{lb}}=\min{\widehat J_1,\widehat J_3})로 고정,
* 옵티마이저는 표준 스케줄(예: 코사인, AdamW 기본값)을 사용.

**선택적 변형(부록).** 필요하면 동적 가중치 (w) 또는 스케일 (k,\delta)를 도입할 수 있으나 이는 **옵션**으로 부록에 분리해 제시하며, 본문의 모든 정리·명제는 기본 설정((w=k=\delta=0))에서 이미 성립한다.

---

> **정책 재확인.** §6 전반의 설정은 하이퍼파라미터 *튜닝 없음* 원칙과 합치되며, 구현 시 기본값만으로 재현 가능함을 목표로 한다.
## 7. 메모리‑뱅크 레이어를 갖춘 입력‑볼록 신경망
> **정의·정리 요약(§7 전역 규약).** 본 절에서는 입력‑볼록 포텐셜 \(u_\theta\)를 구성하기 위해 메모리‑뱅크 \(m(x)\)을 갖춘 ICNN을 사용한다. 기본 형태는
> \[ z_{\ell+1}(x)=\sigma\!\big(W_\ell^+ z_\ell(x)+U_\ell^+ m(x)+V_\ell x+b_\ell\big),\quad u_\theta(x)=w^\top z_L(x)+d. \]
> 여기서 \(\sigma\)는 볼록·비감소, 행렬 \(W_\ell^+,U_\ell^+\ge0\)로 비음수 제약을 둔다. 메모리‑뱅크는 max‑affine / log‑sum‑exp / 이차 프로토타입 중 하나를 택한다. 이 규약을 전제하고 7.1–7.4를 전개한다.

### 7.1 아키텍처
초기 상태를 \(z_0(x)=x\)로 두고 층 \(\ell=0,\dots,L-1\)에 대해 다음을 계산한다.
\[z_{\ell+1}(x)=\sigma\big(W_\ell^+ z_\ell(x)+U_\ell^+ m(x)+V_\ell x+b_\ell\big).\]
여기서 \(W_\ell^+, U_\ell^+\)는 원소별 비음수이고, \(\sigma\)는 볼록이면서 비감소인 활성함수이며, 메모리‑뱅크 \(m\)은 다음 가운데 하나로 정의한다.
- Max‑affine: \(m(x)=\max_k\{\langle a_k,x\rangle+b_k\}\)
- Log‑sum‑exp: \(m(x)=\tau\log\sum_k \exp((\langle a_k,x\rangle+b_k)/\tau)\)
- 이차 프로토타입: \(m(x)=\max_k\{\alpha_k\|x-k_k\|^2+\langle\beta_k,x\rangle+\gamma_k\}\)이며 \(\alpha_k\ge0\)

읽기 연산을 통해 볼록 함수 \(u_\theta(x)=w^{\top} z_L(x)+d\)를 얻고, 포텐셜 \(\varphi_\theta(x)=\|x\|^2-u_\theta(x)\)를 정의한다.

### 7.2 볼록성 보존
**정리 7.1.** 위의 세 가지 \(m\)은 모두 볼록 함수이다. 또한 \(\sigma\)가 볼록이면서 비감소이고 \(W_\ell^+, U_\ell^+\ge0\)이면 모든 \(z_\ell\)이 볼록이므로 \(u_\theta\) 역시 볼록이다.

**증명.** 비음수 선형결합은 볼록성을 보존하고, 선형변환은 볼록이며, 볼록이면서 비감소인 활성함수와의 합성은 볼록성을 유지한다. 귀납법을 적용하면 각 층의 볼록성이 따라온다.

### 7.3 표현력과 안정성
**표현력.** 충분한 폭의 max‑affine/패스스루는 연속 볼록함수에 대해 균일 근사를 제공한다.  
**안정성.** log‑sum‑exp 메모리‑뱅크는 미분가능 근사로서 그래디언트 변동을 제어하며(온도 \(\tau\)), 이차 프로토타입은 지역적 곡률을 안정적으로 캡처한다.  
**실증 포인트.** 메모리‑뱅크 폭/온도/프로토타입 수를 증가시키면 §8의 근사오차 \(\varepsilon\)이 감소하고, §5의 하한 타이트니스가 향상된다.
### 7.4 구현 지침
- 비음수 제약: \(W_\ell^+,U_\ell^+\)은 softplus 또는 clamp로 파라미터화.  
- 메모리‑뱅크 가중치 \(\alpha_k\ge0\): softplus로 보장, 슬롯 정규화(softmin)로 수치 안정화.  
- 온도 \(\tau\): 크게 시작해 점감(과도한 날카로움 방지).  
- 패스스루 경로 \(V_\ell x\): 과소표현/기울기 소실 방지용 잔차 역할.  
- 자동미분: log‑sum‑exp는 안정적 구현을 위해 shift‑trick 사용.
## 8. 오차 제어: 포텐셜 근사에서 거리 바이어스로
컴팩트 집합 \(K\)가 \(\operatorname{supp}(\mu)\cup\operatorname{supp}(\nu)\)를 포함하고, 참 볼록 함수 \(u_*\)에 대한 근사 \(u_\theta\)의 균일 오차가 \(\varepsilon\)이라고 하자. 포텐셜 \(\varphi_\theta=\|\cdot\|^2-u_\theta\)에 대해 다음 부등식이 성립한다.
\[
0\le W_2^2(\mu,\nu)-J_1(\varphi_\theta)\le C(K,\mu,\nu)\,\varepsilon.
\]
**근거.** 보조정리 4.4와 지배수렴정리에 의해 세미듀얼 함수는 집합 \(K\)에서 \(u\)에 대해 Lipschitz 연속이다. 상수는 2차 모멘트와 지지의 직경에 의존한다. 메모리‑뱅크의 폭을 늘리면 \(\varepsilon\)이 단조 감소하므로 상계가 개선된다.

---

> **이론–실험 연결.** 근사 오차 \(arepsilon\)가 줄수록 §5의 하한은 더 타이트해지며, 이는 §9의 소거 실험에서 메모리‑뱅크 폭/온도에 대한 성능 향상으로 관측된다.
## 9. 이후 구성
실험과 결론은 동일한 형식을 따른다. 문제 설정, 데이터셋으로서 Gaussian mixtures와 MNIST 두 자리 숫자 분포, 학습 세부 사항, 임계값 \(\tau\)와 메모리‑뱅크 크기에 대한 소거 실험, 그리고 \(\widehat J_1\)과 \(\widehat J_3\) 및 갭 관련 진단의 정량 곡선을 제시한다.

---

## 부록 A. 완전 전개된 증명
**A.1. 보조정리 4.4의 증명.** 볼록 \(u\)와 임의의 \(z\)에 대해 \(u(x)+u^*(z)\ge \langle z,x\rangle\)가 성립한다. \(z=2y\)와 \(x=y\)를 대입하면 \(u(y)+u^*(2y)\ge 2\|y\|^2\)가 된다. 이를 4.2절 식에 대입하여 \(\varphi^{\,c}(y)\le-\varphi(y)\)를 얻는다.

**A.2. 명제 6.1의 증명.** 각 \(g_i\)가 매끄러운 함수일 때 \(g(y;\theta)=\min_i g_i(y;\theta)\)의 서브그라디언트는 활성 지수 집합 \(I(y;\theta)\)에 대해 \(\partial g=\operatorname{co}\{\nabla g_i:i\in I\}\)로 주어진다. 표본에 대해 평균을 취하면 \(\widehat\Delta\)와 \(\widehat J\)의 편향 없는 서브그라디언트를 얻는다.

**A.3. 정리 6.2의 개요.** 갭이 큰 구간에서는 일관성 집합 근방에서의 강제성으로 기대 감소가 보장되고, 갭이 작은 구간에서는 하한 상승이 \(W_2^2\)로 상계되는 준마팅게일형 상승을 유도한다. Robbins–Siegmund 류의 결과를 적용하면 수렴 성질이 따른다.

---

**비고. 범위**  본 원고는 2‑Wasserstein 거리의 추정 문제에 한정한다. 생성 모델 학습, 샘플 생성, 퍼셉추얼 평가는 다루지 않는다.